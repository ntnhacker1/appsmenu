#include <GUIConstantsEx.au3>
#include <WindowsConstants.au3>
#include <Array.au3>
#include <File.au3>
#include <GUIConstantsEx.au3>
#include <GUIConstants.au3>
#include "GUIScrollbars_Ex.au3"
#include <GuiButton.au3>
#include <StringConstants.au3>
#include <InetConstants.au3>
#include "_Zip.au3"
#include "GIFAnimation.au3"

$x = 25
$y = 110
$p = 1
Global $wide = 826
Global $high = 517
$input = @ScriptDir & "\menu"
Global $button[]
Global $version = "3.5"

#Region ### START Koda GUI section ### Form=
$Form1 = GUICreate("Apps Menu",$wide,$high,(@DesktopWidth-$wide)/2, (@DesktopHeight-$high)/2,$WS_POPUP)
$Pic1 = _GUICtrlCreateGIF("data.dll","10;1", 0,-8, 828, 84)
$menu = GUICtrlCreateMenu("Menu")
$power = GUICtrlCreateMenu("Power", $menu)
$shutdown = GUICtrlCreateMenuItem("Shutdown", $power)
$reset = GUICtrlCreateMenuItem("Restart", $power)
$update = GUICtrlCreateMenuItem("Update", $menu)
$mini = GUICtrlCreateMenuItem("Minimize", $menu)
$exit = GUICtrlCreateMenuItem("Exit", $menu)
$find = _GUICtrlCreateGIF("data.dll","PNG;1", 625, 82,20, 20)

$searchInput = GUICtrlCreateInput("", 650, 82, 150, 20)
GUICtrlSetStyle(-1, $ES_AUTOHSCROLL + $ES_WANTRETURN, $WS_EX_WINDOWEDGE)
GUICtrlSetFont(-1, 11, 500, Default, "Segoe UI", 5)
GUICtrlSetColor(-1,0x6A1B9A)
GUICtrlSetTip(-1, "Tìm kiếm...")
Local $aFileList = _FileListToArray($input, "*")

for $i=1 to $aFileList[0] Step 1
	 $path = @ScriptDir & "\menu\" & $aFileList[$i]
	 $aDetails_wrong = FileGetShortcut($path)
	$button[$p]=GUICtrlCreateButton('',$x,$y, 75, 75,$BS_ICON)
	GUICtrlSetImage(-1,$aDetails_wrong[0],0)
	GUICtrlSetTip(-1,$aFileList[$i])
	GUICtrlSetCursor(-1,0)


    $x = $x + 100
	$p = $p + 1
	if mod($p,8)==1 then
	$x= 25
	$y = $y + 130
	_GUIScrollbars_Generate($Form1,0,$y+130)
	EndIf
Next
Dim $Form1_AccelTable[1][2] = [["{Enter}", $find]]
GUISetAccelerators($Form1_AccelTable)
GUISetState(@SW_SHOW)
#EndRegion ### END Koda GUI section ###

While 1
	$nMsg = GUIGetMsg()
	Switch $nMsg
		Case $GUI_EVENT_CLOSE
			Exit
		Case $mini
			WinSetState($Form1, "", @SW_MINIMIZE)
		case $exit
			Exit
		case $find
			find()
		case $shutdown
			$t = MsgBox (4, "Thông báo" ,"Xác nhận TẮT MÁY!")
If $t = 6 Then
    SplashTextOn ("", "Đang tiến hành TẮT MÁY", 270, 50,-1,-1,1,-1,14,600)
	Shutdown(1)
EndIf
		case $reset
			$t = MsgBox (4, "Thông báo" ,"Xác nhận KHỞI ĐỘNG LẠI MÁY!")
If $t = 6 Then
    SplashTextOn ("", "Đang tiến hành KHỞI ĐỘNG LẠI MÁY", 370, 50,-1,-1,1,-1,14,600)
	Shutdown(2)
EndIf
		case $update
update_launcher()
	EndSwitch
          For $i = 1 To UBound($aFileList)
            If $nMsg == $button[$i] Then
	 $path = @ScriptDir & "\menu\" & $aFileList[$i]
				ShellExecute($path)
				WinSetState($Form1,"",@SW_MINIMIZE)
                ExitLoop
            EndIf
        Next
WEnd

func find()
Local $searchTerm = GUICtrlRead($searchInput)
    If $searchTerm <> "" Then
        For $i = 1 To UBound($button)
            If StringInStr($aFileList[$i], $searchTerm) Then
				$pos = ControlGetPos($Form1, "", $button[$i])
				GUICtrlSetPos($button[1], $pos[0],$pos[1])
                GUICtrlSetPos($button[$i], 25, 110) ; move found button to top of GUI
                ExitLoop
            EndIf
        Next
    EndIf
	EndFunc
  func update_launcher()
  endfunc
